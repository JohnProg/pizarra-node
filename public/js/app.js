// Generated by CoffeeScript 1.3.3
(function() {
  var canvasApp, canvasSupport;

  canvasSupport = function() {
    return Modernizr.canvas;
  };

  canvasApp = function() {
    var buttonClean, clean, closeLine, context, draw, init, socket, startLine, theCanvas;
    clean = function(context) {
      context.fillStyle = "green";
      return context.fillRect(0, 0, theCanvas.width, theCanvas.height);
    };
    startLine = function(e) {
      context.beginPath();
      context.strokeStyle = "white";
      context.lineCap = "round";
      context.lineWidth = 5;
      return context.moveTo(e.clientX - theCanvas.offsetLeft, e.clientY - theCanvas.offsetTop);
    };
    closeLine = function(e) {
      return context.closePath();
    };
    draw = function(e) {
      context.lineTo(e.clientX - theCanvas.offsetLeft, e.clientY - theCanvas.offsetTop);
      return context.stroke();
    };
    init = function() {
      var block, click;
      clean(context);
      click = false;
      block = false;
      return socket.on("connect", function() {
        buttonClean.addEventListener("click", (function() {
          if (!block) {
            return socket.emit("clean", true);
          }
        }), false);
        theCanvas.addEventListener("mousedown", (function(e) {
          if (!block) {
            socket.emit("startLine", {
              clientX: e.clientX,
              clientY: e.clientY
            });
            click = true;
            return startLine(e);
          }
        }), false);
        window.addEventListener("mouseup", (function(e) {
          if (!block) {
            socket.emit("closeLine", {
              clientX: e.clientX,
              clientY: e.clientY
            });
            click = false;
            return closeLine(e);
          }
        }), false);
        theCanvas.addEventListener("mousemove", (function(e) {
          if (click) {
            if (!block) {
              socket.emit("draw", {
                clientX: e.clientX,
                clientY: e.clientY
              });
              return draw(e);
            }
          }
        }), false);
        socket.on("down", function(e) {
          if (!click) {
            block = true;
            return startLine(e);
          }
        });
        socket.on("up", function(e) {
          if (!click) {
            block = false;
            return closeLine(e);
          }
        });
        socket.on("move", function(e) {
          if (block) {
            return draw(e);
          }
        });
        return socket.on("clean", clean(context));
      });
    };
    if (canvasSupport()) {
      theCanvas = document.getElementById("canvas");
      context = theCanvas.getContext("2d");
      buttonClean = document.getElementById("clean");
      socket = io.connect("/");
      return init();
    }
  };

  window.onload = function() {
    return canvasApp();
  };

}).call(this);
